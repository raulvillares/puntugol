<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Puntugol</title>
  <script src="https://cdn.jsdelivr.net/npm/@hotwired/stimulus@3.2.1/dist/stimulus.umd.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script>
    const application = Stimulus.Application.start();

    application.register("form", class extends Stimulus.Controller {
      static targets = [
        "team", "player", "opponent", "difficulty",
        "saves", "keySaves", "goodPlays",
        "effort", "attitude",
        "modal", "scoreCircle", "resultPlayer", "resultComment"
      ];

      calculateScore(event) {
        event.preventDefault();

        const difficultyWeights = {
          inferior: 10,
          parejo: 20,
          ligeramente_superior: 30,
          superior: 40,
          muy_superior: 50,
        };

        const effortWeights = {
          bajas: 5,
          normales: 10,
          altas: 20,
          muy_altas: 30,
        };

        const attitudeWeights = {
          mejorable: 10,
          normal: 20,
          buena: 30,
          muy_buena: 40,
          excelente: 50,
        };

        const difficulty = difficultyWeights[this.difficultyTarget.value];
        const saves = parseInt(this.savesTarget.value || 0);
        const keySaves = parseInt(this.keySavesTarget.value || 0);
        const goodPlays = parseInt(this.goodPlaysTarget.value || 0);
        const effort = effortWeights[this.effortTarget.value];
        const attitude = attitudeWeights[this.attitudeTarget.value];

        const score = Math.min(
          100,
          difficulty * 0.8 + saves * 1.6 + keySaves * 4 + goodPlays * 3 +
            effort * 0.8 + attitude * 0.7
        );

        const comments = [
          "Mejorable 😟", 
          "Normal 🙂", 
          "Bien 👍", 
          "Muy Bien 🌟", 
          "Excelente 🎉", 
          "Impresionante 💪", 
          "¡Increíble! 🏆"
        ];
        const commentIndex = Math.max(0, Math.floor(score / 10) - 5);

        // Actualizar el contenido del modal
        this.resultPlayerTarget.innerText = `Jugador: ${this.playerTarget.value}`;
        this.resultCommentTarget.innerText = comments[commentIndex] || "Mejorable";

        let bgColor = "bg-red-500"; // Default: Rojo para puntuaciones bajas
        if (score >= 50 && score < 70) bgColor = "bg-yellow-500"; // Amarillo
        if (score >= 70 && score < 90) bgColor = "bg-green-500"; // Verde
        if (score >= 90) bgColor = "bg-blue-500"; // Azul
        this.scoreCircleTarget.className = `w-32 h-32 flex items-center justify-center rounded-full text-white font-bold text-4xl ${bgColor}`;
        this.scoreCircleTarget.innerText = Math.round(score);

        // Mostrar el modal
        this.modalTarget.classList.remove("hidden");

        // Lanzar confeti si la puntuación es 80 o más
        if (score >= 80) {
          confetti({
            particleCount: 100,
            spread: 70,
            origin: { y: 0.6 },
          });
        }
      }

      closeModal() {
        this.modalTarget.classList.add("hidden");
      }
    });
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Comic Sans MS', sans-serif;
      background: url('img/logo.png') no-repeat center;
      background-size: 200px;
      background-color: #e0f7ff;
    }
  </style>
  <link rel="icon" type="image/png" href="img/logo.png">
</head>
<body class="bg-blue-100 min-h-screen flex flex-col items-center justify-center p-4">

  <!-- Encabezado con el logo -->
  <div data-controller="form" class="w-full max-w-md bg-white rounded-xl shadow-lg p-6 text-center">
    <img src="img/logo.png" alt="Puntugol Logo" class="mx-auto mb-4 w-32 h-auto">
    <h1 class="text-3xl font-bold text-center text-blue-600 mb-4">¡Bienvenido a Puntugol!</h1>

    <!-- Formulario -->
    <form data-action="submit->form#calculateScore">
      <div class="mb-4">
        <label class="block text-blue-700 font-bold mb-2" for="team">Nombre del equipo</label>
        <input type="text" id="team" data-form-target="team" class="w-full px-4 py-2 border rounded" required>
      </div>
      <div class="mb-4">
        <label class="block text-blue-700 font-bold mb-2" for="player">Nombre del niño</label>
        <input type="text" id="player" data-form-target="player" class="w-full px-4 py-2 border rounded" required>
      </div>
      <div class="mb-4">
        <label class="block text-blue-700 font-bold mb-2" for="opponent">Nombre del rival</label>
        <input type="text" id="opponent" data-form-target="opponent" class="w-full px-4 py-2 border rounded" required>
      </div>
      <div class="mb-4">
        <label class="block text-blue-700 font-bold mb-2" for="difficulty">Dificultad del rival</label>
        <select id="difficulty" data-form-target="difficulty" class="w-full px-4 py-2 border rounded">
          <option value="inferior">Inferior</option>
          <option value="parejo">Parejo</option>
          <option value="ligeramente_superior">Ligeramente Superior</option>
          <option value="superior">Superior</option>
          <option value="muy_superior">Muy Superior</option>
        </select>
      </div>
      <div class="mb-4">
        <label class="block text-blue-700 font-bold mb-2" for="saves">Paradas</label>
        <input type="number" id="saves" data-form-target="saves" class="w-full px-4 py-2 border rounded" min="0">
      </div>
      <div class="mb-4">
        <label class="block text-blue-700 font-bold mb-2" for="keySaves">Paradas salvadoras</label>
        <input type="number" id="keySaves" data-form-target="keySaves" class="w-full px-4 py-2 border rounded" min="0">
      </div>
      <div class="mb-4">
        <label class="block text-blue-700 font-bold mb-2" for="goodPlays">Buenas jugadas</label>
        <input type="number" id="goodPlays" data-form-target="goodPlays" class="w-full px-4 py-2 border rounded" min="0">
      </div>
      <div class="mb-4">
        <label class="block text-blue-700 font-bold mb-2" for="effort">Ganas</label>
        <select id="effort" data-form-target="effort" class="w-full px-4 py-2 border rounded">
          <option value="bajas">Bajas</option>
          <option value="normales">Normales</option>
          <option value="altas">Altas</option>
          <option value="muy_altas">Muy Altas</option>
        </select>
      </div>
      <div class="mb-4">
        <label class="block text-blue-700 font-bold mb-2" for="attitude">Actitud</label>
        <select id="attitude" data-form-target="attitude" class="w-full px-4 py-2 border rounded">
          <option value="mejorable">Mejorable</option>
          <option value="normal">Normal</option>
          <option value="buena">Buena</option>
          <option value="muy_buena">Muy Buena</option>
          <option value="excelente">Excelente</option>
        </select>
      </div>
      <button type="submit" class="w-full bg-blue-600 text-white font-bold py-2 px-4 rounded hover:bg-blue-700">
        Calcular Puntuación
      </button>
    </form>
	
    <!-- Modal para el resultado -->
    <div data-form-target="modal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden">
      <div class="bg-white p-6 rounded-lg shadow-lg text-center">
        <img src="img/logo.png" alt="Puntugol Logo" class="mx-auto mb-4 w-32 h-auto">
        <div class="mx-auto mb-4">
          <div 
            class="w-32 h-32 flex items-center justify-center rounded-full text-white font-bold text-4xl" 
            data-form-target="scoreCircle"></div>
        </div>
        <h2 class="text-2xl font-bold mb-2" data-form-target="resultPlayer"></h2>
        <p class="text-lg mt-2 mb-4" data-form-target="resultComment"></p>
        <button data-action="click->form#closeModal" class="bg-blue-600 text-white font-bold py-2 px-4 rounded hover:bg-blue-700">
          Cerrar
        </button>
      </div>
    </div>
  </div>

</body>
</html>